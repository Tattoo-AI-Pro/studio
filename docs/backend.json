{
  "entities": {
    "AiBook": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiBook",
      "type": "object",
      "description": "Represents an AI-Book, which is a collection of tattoo designs compiled and managed by the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI-Book entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the AI-Book."
        },
        "shortDescription": {
          "type": "string",
          "description": "Short description of the AI-Book."
        },
        "longDescription": {
          "type": "string",
          "description": "Long description of the AI-Book."
        },
        "theme": {
          "type": "string",
          "description": "Theme of the AI-Book."
        },
        "targetAudience": {
          "type": "string",
          "description": "Target audience for the AI-Book."
        },
        "tags": {
          "type": "string",
          "description": "Tags associated with the AI-Book for SEO purposes."
        },
        "coverImageUrl": {
          "type": "string",
          "description": "URL of the cover image for the AI-Book.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the AI-Book."
        },
        "promotionalPrice": {
          "type": "number",
          "description": "Promotional price of the AI-Book (optional)."
        },
        "salesLink": {
          "type": "string",
          "description": "Link to the sales page for the AI-Book.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "shortDescription",
        "longDescription",
        "theme",
        "targetAudience",
        "tags",
        "coverImageUrl",
        "price"
      ]
    },
    "Module": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Module",
      "type": "object",
      "description": "Represents a module within an AI-Book, containing a set of tattoo images and related information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Module entity."
        },
        "aiBookId": {
          "type": "string",
          "description": "Reference to AiBook. (Relationship: AiBook 1:N Module)"
        },
        "name": {
          "type": "string",
          "description": "Name of the module."
        },
        "subDescription": {
          "type": "string",
          "description": "Sub-description of the module."
        },
        "estimatedImageCount": {
          "type": "number",
          "description": "Estimated number of images in the module."
        }
      },
      "required": [
        "id",
        "aiBookId",
        "name",
        "subDescription",
        "estimatedImageCount"
      ]
    },
    "Image": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Image",
      "type": "object",
      "description": "Represents a tattoo image within a module.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Image entity."
        },
        "moduleId": {
          "type": "string",
          "description": "Reference to Module. (Relationship: Module 1:N Image)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the tattoo image.",
          "format": "uri"
        },
        "suggestedTitle": {
          "type": "string",
          "description": "Suggested title for the image generated by AI."
        },
        "aiDescription": {
          "type": "string",
          "description": "Description of the image generated by AI."
        },
        "categories": {
          "type": "array",
          "description": "Categories associated with the image (e.g., realism, fineline, female).",
          "items": {
            "type": "string"
          }
        },
        "keywords": {
          "type": "string",
          "description": "Keywords associated with the image for search and SEO."
        },
        "copyMacro": {
          "type": "string",
          "description": "Macro copy for selling the image."
        }
      },
      "required": [
        "id",
        "moduleId",
        "imageUrl",
        "suggestedTitle",
        "aiDescription",
        "categories",
        "keywords",
        "copyMacro"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "user",
          "schema": {
            "$ref": "#/backend/entities/user"
          },
          "description": "Represents a user of the application. This path serves as the root for all user-specific data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/aiBooks/{aiBookId}",
        "definition": {
          "entityName": "AiBook",
          "schema": {
            "$ref": "#/backend/entities/AiBook"
          },
          "description": "Represents an AI-Book created by the user.  This path enforces user ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (owner of the AI-Book)."
            },
            {
              "name": "aiBookId",
              "description": "The unique identifier for the AI-Book."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/aiBooks/{aiBookId}/modules/{moduleId}",
        "definition": {
          "entityName": "Module",
          "schema": {
            "$ref": "#/backend/entities/Module"
          },
          "description": "Represents a module within an AI-Book, created by the user. This path enforces user ownership and AI-Book context.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (owner of the AI-Book and Module)."
            },
            {
              "name": "aiBookId",
              "description": "The unique identifier for the AI-Book that contains the module."
            },
            {
              "name": "moduleId",
              "description": "The unique identifier for the Module."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/aiBooks/{aiBookId}/modules/{moduleId}/images/{imageId}",
        "definition": {
          "entityName": "Image",
          "schema": {
            "$ref": "#/backend/entities/Image"
          },
          "description": "Represents an image within a module in an AI-Book, created by the user. This path enforces user ownership, AI-Book context, and module context.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (owner of the AI-Book, Module, and Image)."
            },
            {
              "name": "aiBookId",
              "description": "The unique identifier for the AI-Book that contains the module."
            },
            {
              "name": "moduleId",
              "description": "The unique identifier for the Module that contains the image."
            },
            {
              "name": "imageId",
              "description": "The unique identifier for the Image."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the \"AI-Book Factory\" application, focusing on secure, scalable, and debuggable data management. The structure is optimized for AI-Book creation, module management, image analysis, and sales/distribution, as outlined in the application's core features.  It emphasizes authorization independence, clarity, and predictable schemas for simplified security rules. All paths follow a strict ownership model, rooted in the user's UID, and avoids relying on complex authorization logic. \n\n**Authorization Independence and Data Denormalization:**\n\n*   AiBooks, Modules, and Images are stored under the user's document using hierarchical paths.  This allows the system to secure each level of the product hierarchy and ensure complete ownership. No denormalization of user data is required, as the user ID is encoded in the path itself.\n\n**Structural Segregation:**\n\n*   Data with different security needs are segregated into separate collections. User-specific AI-Books, modules, and images are stored under `/users/{userId}`, while global data (if any) would reside in separate top-level collections with different security rules.\n\n**Access Modeling:**\n\n*   Private data is enforced through path-based ownership (`/users/{userId}/aiBooks/{aiBookId}`).\n*   User-owned entities follow the pattern `/users/{userId}/{entity}/{entityId}` for 1:N relationships.\n\n**QAPs Support:**\n\n*   The structure allows for secure listing of AI-Books, modules, and images owned by a specific user. Rules can easily enforce that only the user identified by `{userId}` can list resources under their path."
  }
}