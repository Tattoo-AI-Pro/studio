{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches Firebase Auth UID)."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "photoURL": {
          "type": "string",
          "format": "uri",
          "description": "URL of the user's profile picture."
        }
      },
      "required": ["id", "email"]
    },
    "AiBook": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiBook",
      "type": "object",
      "description": "Represents an AI-Book, a collection of tattoo designs organized and optimized by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI-Book."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who owns this AI-Book."
        },
        "name": {
          "type": "string",
          "description": "The name of the AI-Book."
        },
        "shortDescription": {
          "type": "string",
          "description": "A brief description of the AI-Book."
        },
        "longDescription": {
          "type": "string",
          "description": "A detailed description of the AI-Book."
        },
        "theme": {
          "type": "string",
          "description": "The main theme of the AI-Book (e.g., 'Floral', 'Geometric')."
        },
        "targetAudience": {
          "type": "string",
          "description": "The target audience for the AI-Book (e.g., 'Beginner Tattoo Artists', 'Women Seeking Small Tattoos')."
        },
        "tags": {
          "type": "array",
          "description": "Tags for internal SEO purposes.",
          "items": {
            "type": "string"
          }
        },
        "coverImage": {
          "type": "string",
          "description": "URL or path to the cover image of the AI-Book."
        },
        "price": {
          "type": "number",
          "description": "The price of the AI-Book."
        },
        "promotionalPrice": {
          "type": "number",
          "description": "The promotional price of the AI-Book, if applicable."
        },
        "salesLink": {
          "type": "string",
          "description": "Link to the sales page for the AI-Book."
        }
      },
      "required": [
        "id",
        "ownerId",
        "name",
        "shortDescription",
        "theme",
        "targetAudience"
      ]
    },
    "Module": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Module",
      "type": "object",
      "description": "Represents a module within an AI-Book, containing a set of tattoo images.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Module."
        },
        "aiBookId": {
          "type": "string",
          "description": "Reference to AiBook. (Relationship: AiBook 1:N Module)"
        },
        "name": {
          "type": "string",
          "description": "The name of the module."
        },
        "subDescription": {
          "type": "string",
          "description": "A brief description of the module."
        },
        "estimatedImages": {
          "type": "number",
          "description": "The estimated number of images in the module."
        }
      },
      "required": [
        "id",
        "aiBookId",
        "name"
      ]
    },
    "Image": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Image",
      "type": "object",
      "description": "Represents a tattoo image within a module.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Image."
        },
        "moduleId": {
          "type": "string",
          "description": "Reference to Module. (Relationship: Module 1:N Image)"
        },
        "title": {
          "type": "string",
          "description": "The title of the image, suggested by AI."
        },
        "description": {
          "type": "string",
          "description": "Description of the image, generated by AI."
        },
        "categories": {
          "type": "array",
          "description": "Categories the image belongs to (e.g., 'Realism', 'Fineline').",
          "items": {
            "type": "string"
          }
        },
        "keywords": {
          "type": "array",
          "description": "Keywords associated with the image for search and SEO.",
          "items": {
            "type": "string"
          }
        },
        "copyMacro": {
          "type": "string",
          "description": "A 'copy macro' for selling the image/design."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL or path to the tattoo image."
        }
      },
      "required": [
        "id",
        "moduleId",
        "imageUrl"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores public user profile information.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (matches Firebase Auth UID)."
            }
          ]
        }
      },
      {
        "path": "/ai_books/{aiBookId}",
        "definition": {
          "entityName": "AiBook",
          "schema": {
            "$ref": "#/backend/entities/AiBook"
          },
          "description": "Stores AI-Books metadata. The structure facilitates listing operations since all AI-Books share the same security requirements.",
          "params": [
            {
              "name": "aiBookId",
              "description": "The unique identifier of the AI-Book."
            }
          ]
        }
      },
      {
        "path": "/ai_books/{aiBookId}/modules/{moduleId}",
        "definition": {
          "entityName": "Module",
          "schema": {
            "$ref": "#/backend/entities/Module"
          },
          "description": "Stores modules associated with an AI-Book.",
          "params": [
            {
              "name": "aiBookId",
              "description": "The unique identifier of the AI-Book."
            },
            {
              "name": "moduleId",
              "description": "The unique identifier of the Module."
            }
          ]
        }
      },
      {
        "path": "/ai_books/{aiBookId}/modules/{moduleId}/images/{imageId}",
        "definition": {
          "entityName": "Image",
          "schema": {
            "$ref": "#/backend/entities/Image"
          },
          "description": "Stores images associated with a module.",
          "params": [
            {
              "name": "aiBookId",
              "description": "The unique identifier of the AI-Book."
            },
            {
              "name": "moduleId",
              "description": "The unique identifier of the Module."
            },
            {
              "name": "imageId",
              "description": "The unique identifier of the Image."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the AI-Book Factory application, prioritizing authorization independence, clarity, and scalability. The core entities are AiBook, Module, and Image, with a hierarchical relationship (AiBook 1:N Module, Module 1:N Image).  Authorization is handled implicitly via path-based ownership. This design enables secure list operations without filtering in rules (QAPs) and ensures that all documents within a collection share the same security requirements (Homogeneous Security Posture).  The design facilitates atomic operations by avoiding hierarchical authorization dependencies.\n\nSpecifically:\n\n*   `/ai_books/{aiBookId}`: Stores the main AI-Book metadata. The structure facilitates listing operations since all AI-Books share the same security requirements.\n*   `/ai_books/{aiBookId}/modules/{moduleId}`: Stores modules associated with an AI-Book.\n*   `/ai_books/{aiBookId}/modules/{moduleId}/images/{imageId}`: Stores images associated with a module."
  }
}
